<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>My TaskHub</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .priority-1 { border-left: 6px solid #ef4444; }
    .priority-2 { border-left: 6px solid #f59e0b; }
    .priority-3 { border-left: 6px solid #10b981; }
    .glass { background: rgba(255,255,255,.95); backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,.06); }
  </style>
</head>

<body class="bg-[#f8fafc] min-h-screen pb-24">
  <header class="sticky top-0 z-20 bg-[#f8fafc]/80 backdrop-blur-md px-6 py-6">
    <h1 class="text-2xl font-extrabold text-slate-900 tracking-tight">
      My <span class="text-indigo-600">TaskHub</span>
    </h1>
    <p id="stats" class="text-xs font-semibold text-slate-400 uppercase tracking-widest mt-1">Ladeâ€¦</p>
  </header>

  <main class="max-w-md mx-auto px-5">
    <section class="glass rounded-3xl p-5 shadow-sm border border-slate-200 mb-6">
      <input id="title" type="text" placeholder="Neue Aufgabe tippenâ€¦"
        class="w-full text-lg font-semibold bg-transparent border-none focus:ring-0 outline-none mb-4 text-slate-800">

      <div class="grid grid-cols-2 gap-3 mb-3">
        <select id="project" class="bg-slate-100 rounded-xl px-3 py-2 text-sm font-bold text-slate-600 outline-none">
          <option value="Academy">Academy</option>
          <option value="HSE">HSE</option>
          <option value="Recruiting">Recruiting</option>
          <option value="Inbox" selected>Inbox</option>
        </select>

        <select id="prio" class="bg-slate-100 rounded-xl px-3 py-2 text-sm font-bold text-slate-600 outline-none">
          <option value="1">ğŸ”¥ Hoch</option>
          <option value="2" selected>âš¡ Mittel</option>
          <option value="3">ğŸŒ± Niedrig</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-3 mb-4">
        <input id="deadline" type="date" class="bg-slate-100 rounded-xl px-3 py-2 text-sm font-bold text-slate-600 outline-none">
        <input id="notes" type="text" placeholder="Notiz (optional)"
          class="bg-slate-100 rounded-xl px-3 py-2 text-sm font-bold text-slate-600 outline-none">
      </div>

      <button id="addBtn" class="w-full bg-slate-900 text-white font-bold py-3.5 rounded-2xl active:bg-slate-800 transition-colors shadow-lg">
        HinzufÃ¼gen
      </button>

      <p id="msg" class="hidden mt-3 text-sm font-bold text-red-500"></p>
    </section>

    <div id="list" class="space-y-4"></div>
  </main>

  <script>
    // ---- SUPER ROBUST TASK APP ----
    const KEY = "taskhub_simple_v1";

    function load() {
      try { return JSON.parse(localStorage.getItem(KEY)) || []; }
      catch { return []; }
    }
    function save(tasks) {
      localStorage.setItem(KEY, JSON.stringify(tasks));
    }

    let tasks = load();

    function $(id){ return document.getElementById(id); }

    function showMsg(text){
      const el = $("msg");
      el.textContent = text;
      el.classList.remove("hidden");
      setTimeout(() => el.classList.add("hidden"), 2000);
    }

    function render(){
      const list = $("list");
      list.innerHTML = "";

      const open = tasks.filter(t => !t.done).length;
      $("stats").textContent = `${open} offen Â· ${tasks.length - open} erledigt`;

      if(tasks.length === 0){
        list.innerHTML = `
          <div class="glass rounded-3xl p-6 border border-slate-200 text-center">
            <p class="text-sm font-extrabold text-slate-900">Keine Aufgaben</p>
            <p class="text-xs font-semibold text-slate-500 mt-2">FÃ¼ge oben eine neue Aufgabe hinzu.</p>
          </div>
        `;
        return;
      }

      // sort: open first, then prio
      tasks.sort((a,b) => (a.done - b.done) || (a.prio - b.prio));

      tasks.forEach(t => {
        const card = document.createElement("div");
        card.className = `glass priority-${t.prio} p-4 rounded-2xl shadow-sm flex items-center gap-4 ${t.done ? "opacity-40" : ""}`;

        card.innerHTML = `
          <button class="toggle h-7 w-7 rounded-full border-2 border-indigo-500 flex-shrink-0 flex items-center justify-center" data-id="${t.id}">
            ${t.done ? '<div class="h-4 w-4 bg-indigo-500 rounded-full"></div>' : ''}
          </button>

          <div class="flex-grow min-w-0">
            <div class="flex items-start justify-between gap-2">
              <h3 class="font-extrabold text-slate-800 ${t.done ? "line-through" : ""} truncate">${escapeHtml(t.title)}</h3>
              <span class="text-[10px] font-black uppercase text-slate-400 flex-shrink-0">${escapeHtml(t.project)}</span>
            </div>

            <div class="flex flex-wrap gap-x-3 gap-y-1 mt-1 items-center">
              <span class="text-[10px] font-black uppercase text-slate-400">ğŸ“… ${t.deadline || "Kein Datum"}</span>
              ${t.notes ? `<span class="text-[10px] font-black uppercase text-slate-400">ğŸ—’ï¸ ${escapeHtml(t.notes)}</span>` : ""}
            </div>

            <div class="flex gap-3 mt-2">
              <button class="del text-[10px] font-black uppercase text-red-400 active:scale-95" data-id="${t.id}">LÃ¶schen</button>
            </div>
          </div>
        `;

        list.appendChild(card);
      });

      // bind events (always after render)
      document.querySelectorAll(".toggle").forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          tasks = tasks.map(t => t.id === id ? ({...t, done: !t.done}) : t);
          save(tasks);
          render();
        };
      });

      document.querySelectorAll(".del").forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          tasks = tasks.filter(t => t.id !== id);
          save(tasks);
          render();
        };
      });
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
      }[m]));
    }

    function addTask(){
      const title = $("title").value.trim();
      if(!title){
        showMsg("Bitte zuerst einen Titel eingeben ğŸ™‚");
        $("title").focus();
        return;
      }

      const task = {
        id: String(Date.now()),
        title,
        project: $("project").value,
        prio: parseInt($("prio").value, 10) || 3,
        deadline: $("deadline").value || "",
        notes: $("notes").value.trim(),
        done: false
      };

      tasks.push(task);
      save(tasks);

      $("title").value = "";
      $("deadline").value = "";
      $("notes").value = "";

      render();
    }

    // bind once
    $("addBtn").onclick = addTask;
    $("title").addEventListener("keydown", (e) => {
      if(e.key === "Enter") addTask();
    });

    // start
    render();
  </script>
</body>
</html>
